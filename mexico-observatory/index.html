<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mexico Green Industrial Policy Observatory</title>
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading Observatory data...</div>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Sidebar toggle (mobile) -->
    <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle sidebar">&#9776;</button>

    <!-- Left Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>Mexico Green Industrial<br>Policy Observatory</h1>
            <div class="subtitle">Net Zero Industrial Policy Lab &middot; Johns Hopkins University<br>Tecnol&oacute;gico de Monterrey</div>
        </div>
        <div class="sidebar-body">
            <!-- Layer selector -->
            <div class="control-group">
                <label for="layer-select">Layer</label>
                <select id="layer-select">
                    <option value="policies">Subnational Industrial Policies</option>
                    <option value="instruments">Instruments</option>
                    <option value="federal">Federal Programs</option>
                    <option value="fdi">Foreign Direct Investment (FDI)</option>
                    <option value="sectors">Dominant Sector</option>
                    <option value="hs_codes">HS Code Sectors</option>
                    <option value="education">Education Policies</option>
                    <option value="rd">R&D Policies</option>
                    <option value="energy">Energy Projects</option>
                    <option value="greenmfg">Green Manufacturing</option>
                    <option value="mines">Mines</option>
                    <option value="polos">Development Poles (Polos de Bienestar)</option>
                </select>
            </div>

            <!-- Status filter -->
            <div class="control-group">
                <label for="status-filter">Status</label>
                <select id="status-filter">
                    <option value="">All Status</option>
                    <option value="Operational">Operational</option>
                    <option value="Under construction">Under construction</option>
                    <option value="Announced">Announced</option>
                    <option value="Paused/Closed">Paused/Closed</option>
                    <option value="Completed">Completed</option>
                    <option value="Planned">Planned</option>
                </select>
            </div>

            <!-- Year slider -->
            <div class="control-group">
                <label>Year</label>
                <div class="year-row">
                    <input type="range" id="year-slider" min="2004" max="2026" value="2026" step="1">
                    <span class="year-value" id="year-label">2026</span>
                </div>
                <label class="checkbox-row" style="text-transform:none; letter-spacing:0; font-weight:400;">
                    <input type="checkbox" id="show-undated" checked>
                    Include undated records
                </label>
                <label class="checkbox-row" style="text-transform:none; letter-spacing:0; font-weight:400;">
                    <input type="checkbox" id="cumulative-mode" checked>
                    Cumulative (all years up to selected)
                </label>
            </div>

            <!-- Show Charts button -->
            <div class="control-group">
                <button class="btn-primary" id="toggle-charts">Show Charts</button>
            </div>

            <!-- Record count -->
            <div class="control-group" style="border-top: 1px solid var(--gray-200); padding-top: 12px;">
                <div style="font-size: 11px; color: var(--gray-500);">
                    Showing <strong id="record-count" style="color: var(--gray-800);">0</strong> records
                </div>
            </div>
        </div>
    </div>

    <!-- Info box -->
    <div class="info-box" id="info-box">
        <strong>Mexico Observatory GIS</strong>
        Hover over states or markers for details. Click for more information.
    </div>

    <!-- Legend -->
    <div class="legend" id="legend"></div>

    <!-- Right chart panel -->
    <div class="chart-panel" id="chart-panel">
        <div class="chart-panel-header">
            <h2>Analytics</h2>
            <button class="btn-close" id="close-charts">Close</button>
        </div>
        <div class="chart-panel-body">
            <div class="stats-row" id="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="stat-1-val">0</div>
                    <div class="stat-label" id="stat-1-label">Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-2-val">0</div>
                    <div class="stat-label" id="stat-2-label">States</div>
                </div>
                <div class="stat-card" id="stat-3-card" style="display:none;">
                    <div class="stat-value" id="stat-3-val">0</div>
                    <div class="stat-label" id="stat-3-label">Extra</div>
                </div>
            </div>
            <div class="chart-section">
                <h3 id="chart-bar-title">Distribution</h3>
                <div class="chart-container" id="container-bar">
                    <canvas id="chart-bar"></canvas>
                </div>
            </div>
            <div class="chart-section">
                <h3 id="chart-pie-title">Green vs. Non-Green</h3>
                <div class="chart-container small" id="container-pie">
                    <canvas id="chart-pie"></canvas>
                </div>
            </div>
            <!-- FDI-Policy Linkage Explorer (visible only on FDI layer) -->
            <div class="chart-section" id="linkage-explorer-section" style="display:none;">
                <h3>FDIâ€“Policy Linkages</h3>
                <div class="linkage-explorer-info">
                    FDI projects matched to subnational policies in the same state with the same SCIAN sector code. These are inferred linkages, not verified causal connections. See RA Guide Section 6b.
                </div>
                <div id="linkage-explorer-list"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/leaflet.js"></script>
    <script src="js/chart.umd.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/embedded-data.js"></script>
    <script src="js/data.js"></script>
    <script src="js/map.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
